<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card">
                    <div class="header" style="border-bottom: 1px solid #00000021;">
                        <h2>Localités</h2>
                        <ul class="header-dropdown m-r--5">
                            <li class="dropdown">
                                <a href="#" onClick="return false;" data-toggle="dropdown" role="button"
                                    aria-haspopup="true" aria-expanded="false">
                                    <i class="material-icons">more_vert</i>
                                </a>
                                <ul class="dropdown-menu pull-right">
                                    <li>
                                        <a href="#" onClick="return false;" 
                                            data-toggle="modal" data-target="#localiteModal" data-backdrop="static" data-keyboard="false"
                                            (click)="initForm()">+ Ajouter</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="body">
                        <mat-accordion>
                            <mat-expansion-panel class="mb-4" *ngFor="let localite of rev(localites)">
                                <mat-expansion-panel-header style="background-color: #d8d5d5;" (click)="pickLocalite(localite)">
                                    <mat-panel-title>
                                        {{localite.nom}} <i class="material-icons icon-localite ml-2"  data-target="#localiteModal" data-backdrop="static" data-keyboard="false"  (click)="updateLoc(localite)">edit</i>
                                        
                                    </mat-panel-title>
                                    <mat-panel-description></mat-panel-description>
                                </mat-expansion-panel-header>
                                    <p class="mt-4 mb-3 bolder">Zones / Sites</p>
                                    <mat-expansion-panel class="mb-4" *ngFor="let zone of rev(localite.zones)">
                                        <mat-expansion-panel-header style="background-color: #eab9b9;">
                                            <mat-panel-title>
                                                {{zone.nom}} <i class="material-icons icon-localite ml-2" style=""
                                                data-toggle="modal" data-target="#zoneModal" data-backdrop="static" data-keyboard="false" (click)="updateZone(zone)">edit</i>
                                            </mat-panel-title>
                                            <mat-panel-description></mat-panel-description>
                                        </mat-expansion-panel-header>
                                        
                                        <div class="row">
                                        
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                                <div class="card">
                                                    <div class="body">
                                                        <mat-form-field class="example-chip-list example-full-width">
                                                            <mat-chip-list #chipList aria-label="Sous zones">
                                                                <mat-chip *ngFor="let sousZone of getSousZone(zone)" [selectable]="selectable" [removable]="removable"
                                                                    (removed)="remove(zone,sousZone)">
                                                                    {{sousZone}}
                                                                    <mat-icon *ngIf="removable" class="ml-2 edit-sousZ pointer text-secondary" (click)="updateSousZones(zone,sousZone)"  (click)="openSZModal.click()">edit</mat-icon>
                                                                    <!---->
                                                                    <mat-icon matChipRemove *ngIf="removable" class="ml-0">cancel</mat-icon>
                                                                    
                                                                </mat-chip>
                                                                <input placeholder="Sous zone" #fruitInput [formControl]="fruitCtrl"
                                                                    [matChipInputFor]="chipList"
                                                                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                                                    (matChipInputTokenEnd)="add($event,zone)">
                                                            </mat-chip-list>
                                                        </mat-form-field>
                                                        <!--Pour editer sous zone -->
                                                        <i data-toggle="modal" hidden data-target="#SousZoneModal" data-backdrop="static" data-keyboard="false" #openSZModal></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </mat-expansion-panel>
                                    <p class="mt-4"><i class="material-icons pointer" title="Ajouter zone/site" data-toggle="modal" data-target="#zoneModal" data-backdrop="static" data-keyboard="false" (click)="pickLocalite(localite)">add_circle</i></p>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!--Localités-->
<div class="modal fade" id="localiteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <form class="modal-content"  [formGroup]="localiteForm" (ngSubmit)="addLocalite(localiteForm)">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17" *ngIf="localiteForm.get('id').value==0">Ajouter une localité</div>
                            <div class="font-weight-bold p-t-10 font-17" *ngIf="localiteForm.get('id').value!=0">Modifier une localité</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closeLocaliteModal
                    class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body">
                <div>
                    <div class="row">
                        <div class="input-field col s12 d-none">
                            <input formControlName="id" class="form-control" type="hidden">
                        </div>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 pb-0">
                            <mat-form-field class="example-full-width" appearance="outline">
                                <mat-label>Nom de la localité</mat-label>
                                <input matInput formControlName="nom" >
                                <mat-icon matSuffix>room</mat-icon>
                                <mat-error *ngIf="localiteForm.get('nom').hasError('required')">
                                    Ce champ est requise
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="modal-footer pr-0 pt-0">
                        <div class="button-demo">
                            <button type="submit" class="btn btn-outline-success btn-border-radius" [disabled]="localiteForm.invalid">Enregistrer</button>
                            <button type="button" class="btn btn-outline-danger btn-border-radius mr-0" data-dismiss="modal">Annuler</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!--Localités-->

<!--Zone-->
<div class="modal fade" id="zoneModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <form class="modal-content"  [formGroup]="zoneForm" (ngSubmit)="addZone(zoneForm)">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17" *ngIf="zoneForm.get('id').value==0">Ajouter une zone</div>
                            <div class="font-weight-bold p-t-10 font-17" *ngIf="zoneForm.get('id').value!=0">Modifier une zone</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closeZoneModal
                    class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body">
                <div>
                    <div class="row">
                        <div class="input-field col s12 d-none">
                            <input formControlName="id" class="form-control" type="hidden">
                        </div>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 pb-0">
                            <mat-form-field class="example-full-width" appearance="outline">
                                <mat-label>Nom de la zone</mat-label>
                                <input matInput formControlName="nom">
                                <mat-icon matSuffix>room</mat-icon>
                                <mat-error *ngIf="zoneForm.get('nom').hasError('required')">
                                    Ce champ est requise
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="modal-footer pr-0 pt-0">
                        <div class="button-demo">
                            <button type="submit" class="btn btn-outline-success btn-border-radius" [disabled]="zoneForm.invalid">Enregistrer</button>
                            <button type="button" class="btn btn-outline-danger btn-border-radius mr-0" data-dismiss="modal">Annuler</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!--Zone-->

<!--Zone-->
<div class="modal fade" id="SousZoneModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <form class="modal-content"  [formGroup]="souZoneForm" (ngSubmit)="updateSZ(souZoneForm)">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17">Modifier sous zone</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closeSousZoneModal
                    class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body">
                <div>
                    <div class="row">
                        <div class="input-field col s12 d-none">
                            <input formControlName="id" class="form-control" type="hidden">
                        </div>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 pb-0">
                            <mat-form-field class="example-full-width" appearance="outline">
                                <mat-label>Nom sous zone</mat-label>
                                <input matInput formControlName="nom">
                                <mat-icon matSuffix>room</mat-icon>
                                <mat-error *ngIf="souZoneForm.get('nom').hasError('required')">
                                    Ce champ est requise
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="modal-footer pr-0 pt-0">
                        <div class="button-demo">
                            <button type="submit" class="btn btn-outline-success btn-border-radius" [disabled]="souZoneForm.invalid">Enregistrer</button>
                            <button type="button" class="btn btn-outline-danger btn-border-radius mr-0" data-dismiss="modal">Annuler</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!--Zone-->
