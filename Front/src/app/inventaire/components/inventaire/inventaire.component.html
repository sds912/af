<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card">
                    <div class="header">
                        <div class="row">
                            <h2 class="col-xl-3 col-lg-3 col-md-3 col-sm-3 pb-0 pt-2 bolder">Inventaires</h2>
                            <ul class="header-dropdown m-r--5">
                                <li class="dropdown">
                                    <button [title]="titleAdd" [disabled]="securityServ.superviseurAdjoint"
                                        class="addInv" (click)="addNew()" mat-mini-fab color="primary"
                                        aria-label="Example icon-button with a heart icon">
                                        <mat-icon>add</mat-icon>
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="body">
                        <mat-accordion multi="true">
                            <!--Add and Update-->
                            <mat-expansion-panel class="mb-4" expanded hideToggle *ngIf="showForm">
                                <mat-expansion-panel-header class="pr-0" style="background-color: #d8d5d5;">
                                    <mat-panel-title class="pl-0 col-11 pt-5 pb-4 mr-0">
                                        <p>
                                            <span *ngIf="editForm.get('id').value==0">Ajouter </span>
                                            <span *ngIf="editForm.get('id').value!=0">Modifier </span>
                                            inventaire
                                        </p>
                                    </mat-panel-title>
                                    <mat-panel-description>

                                    </mat-panel-description>
                                </mat-expansion-panel-header>
                                <!--Corps-->
                                <form class="mt-4" [formGroup]="editForm" #formDirective="ngForm">
                                    <div class="input-field col s12 d-none">
                                        <input formControlName="id" class="form-control" type="hidden">
                                    </div>
                                    <p class="row">
                                        <span class="col-4 bolder pt-3">DATE D'INVENTAIRE</span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Date</mat-label>
                                                <input matInput [matDatepicker]="dateI" formControlName="dateInv">
                                                <mat-datepicker-toggle matSuffix [for]="dateI"></mat-datepicker-toggle>
                                                <mat-datepicker #dateI></mat-datepicker>
                                            </mat-form-field>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row">
                                        <span class="col-4 bolder pt-3">PÉRIODE DE COMPTAGE</span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Début</mat-label>
                                                <input matInput [matDatepicker]="picker" formControlName="debut">
                                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                                <mat-datepicker #picker></mat-datepicker>
                                            </mat-form-field>
                                        </span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Fin</mat-label>
                                                <input matInput [matDatepicker]="picker2" formControlName="fin">
                                                <mat-datepicker-toggle matSuffix [for]="picker2">
                                                </mat-datepicker-toggle>
                                                <mat-datepicker #picker2></mat-datepicker>
                                                <mat-error *ngIf="editForm.get('fin').hasError('diffDate')">Antérieure à
                                                    la date de début</mat-error>
                                            </mat-form-field>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">LOCALITÉS</span>
                                        <span class="col-8">
                                            <button *ngFor="let loc of firstSub(noNull(tabLoc))" mat-mini-fab
                                                [title]="loc.nom" color="primary"
                                                aria-label="Example icon-button with a heart icon" class="mr-2"
                                                data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                data-target="#localiteModal">
                                                <mat-icon>room</mat-icon>
                                            </button>
                                            <button mat-mini-fab title="Ajouter une localité" color="primary"
                                                aria-label="Example icon-button with a heart icon" class="mr-2"
                                                data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                data-target="#localiteModal"
                                                [ngClass]="{'ml-5': noNull(tabLoc)?.length>0}">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">INSTRUCTIONS D'INVENTAIRE</span>
                                        <span class="col-8"
                                            *ngIf="!invCreer && (!instructions||instructions.length==0)">
                                            <button mat-mini-fab title="Ajouter des instructions" color="primary"
                                                aria-label="Example icon-button with a heart icon" class="mr-2"
                                                data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                data-target="#instrucModal" (click)="createNewInv()">
                                                <mat-icon>create</mat-icon>
                                            </button>
                                            <button mat-mini-fab color="primary" title="Importer des instructions"
                                                aria-label="Example icon-button with a heart icon"
                                                (click)="docInst.click()">
                                                <mat-icon>file_upload</mat-icon>
                                            </button>
                                            <input type="file" id="doc" (change)="handleFileInput($event.target.files)"
                                                hidden #docInst multiple>
                                        </span>

                                        <span class="col-8" *ngIf="instructions && instructions.length>0 && !invCreer">
                                            <span class="" *ngFor="let instruction of instructions;let i=index">
                                                <mat-icon [title]="instruction[0]"
                                                    style="font-size: 50px;color: #3f51b5;">insert_drive_file</mat-icon>
                                                <mat-icon [title]="'Supprimer '+instruction[0]" class="pointer"
                                                    style="color: #f80000;" (click)='deleteInst(i)'>cancel</mat-icon>
                                                <button class="addFile" mat-mini-fab (click)="docInst.click()"
                                                    *ngIf="i==(instructions.length-1)"
                                                    title="Ajouter un nouveau document" color="primary"
                                                    aria-label="Example icon-button with a heart icon"
                                                    [ngClass]="{'ml-5': instructions?.length>0}">
                                                    <mat-icon>add</mat-icon>
                                                </button>
                                            </span>
                                            <input type="file" id="doc" (change)="handleFileInput($event.target.files)"
                                                hidden #docInst multiple>
                                        </span>

                                        <span class="col-8" *ngIf="invCreer">
                                            <span class="">
                                                <mat-icon title="Instruction" style="font-size: 50px;color: #3f51b5;"
                                                    data-keyboard="false" data-target="#instrucModal">assignment
                                                </mat-icon>
                                                <mat-icon title="Supprimer l'instruction" class="mr-3 pointer"
                                                    style="color: #f80000;" (click)='deletCreationInst()'>cancel
                                                </mat-icon>
                                                <button class="addFile" mat-mini-fab title="Instruction" color="primary"
                                                    aria-label="Example icon-button with a heart icon"
                                                    data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                    data-target="#instrucModal">
                                                    <mat-icon>create</mat-icon>
                                                </button>
                                            </span>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">DÉCISION DE CRÉATION DU COMITÉ</span>
                                        <span class="col-8" *ngIf="!docsDc||docsDc.length==0">
                                            <button mat-mini-fab color="primary" (click)="docDec.click()"
                                                title="Importer la décision de création"
                                                aria-label="Example icon-button with a heart icon">
                                                <mat-icon>file_upload</mat-icon>
                                            </button>
                                        </span>
                                        <span class="col-8" *ngIf="docsDc && docsDc.length>0">
                                            <span class="" *ngFor="let decision of docsDc;let i=index">
                                                <mat-icon [title]="decision[0]" style="font-size: 50px;color: #3f51b5;">
                                                    insert_drive_file</mat-icon>
                                                <mat-icon [title]="'Supprimer '+decision[0]" class="pointer"
                                                    style="color: #f80000;" (click)='deleteDc(i)'>cancel</mat-icon>
                                                <button class="addFile ml-5" mat-mini-fab (click)="docDec.click()"
                                                    *ngIf="i==(docsDc.length-1)" title="Ajouter un nouveau document"
                                                    color="primary" aria-label="Example icon-button with a heart icon">
                                                    <mat-icon>add</mat-icon>
                                                </button>
                                            </span>

                                        </span>
                                        <input type="file" id="docCrea"
                                            (change)="handleFileInputDc($event.target.files)" hidden #docDec multiple>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">COMITE D'INVENTAIRE</span>
                                        <span class="col-8">
                                            <img *ngIf="getUserById(idPresiComite)"
                                                class="img-circle user-img-circle img-membre pointer mr-3"
                                                [src]="imgLink+getUserById(idPresiComite).image"
                                                [title]="'Président du comité : '+ getUserById(idPresiComite).nom">
                                            <img *ngFor="let id of noNull(tabComite.value)"
                                                class="img-circle user-img-circle img-membre pointer mr-3"
                                                [src]="imgLink+getUserById(id)?.image"
                                                [title]="'Membre du comité : '+ getUserById(id)?.nom">
                                            <button [ngClass]="{'ml-5': noNull(tabComite.value)?.length>0}" mat-mini-fab
                                                color="primary" aria-label="Example icon-button with a heart icon"
                                                data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                data-target="#comiteModal" (click)="openComModal()"
                                                [disabled]="users.length==0">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">RÉUNION DE LANCEMENT</span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Lieu</mat-label>
                                                <input matInput formControlName="lieuReunion">
                                                <mat-icon matSuffix>room</mat-icon>
                                            </mat-form-field>
                                        </span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Date</mat-label>
                                                <input matInput [matDatepicker]="picker3" formControlName="dateReunion">
                                                <mat-datepicker-toggle matSuffix [for]="picker3">
                                                </mat-datepicker-toggle>
                                                <mat-datepicker #picker3></mat-datepicker>
                                            </mat-form-field>
                                        </span>
                                    </p>
                                    <hr>
                                    <div class="row mt-4">
                                        <span class="col-4 pt-3 bolder">PRÉSENTS A LA RÉUNION</span>
                                        <span class="col-8">
                                            <img *ngFor="let id of noNull(tabPresents.value)"
                                                class="img-circle user-img-circle img-membre pointer mr-3 mb-2"
                                                [src]="imgLink+getUserById(id)?.image" [title]="getUserById(id)?.nom">
                                            <img *ngFor="let membre of noNull(tabOtherPresent.value)"
                                                class="img-circle user-img-circle img-membre pointer mr-3 mb-2"
                                                [src]="imgLink+'exemple.jpg'" [title]="membre">
                                            <button mat-mini-fab color="primary"
                                                aria-label="Example icon-button with a heart icon"
                                                aria-label="Example icon-button with a heart icon" data-toggle="modal"
                                                data-backdrop="static" data-keyboard="false"
                                                [ngClass]="{'ml-5': noNull(tabOtherPresent.value)?.length>0}"
                                                data-target="#presentModal" (click)="openPresModal()"
                                                [disabled]="users.length==0">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </span>
                                    </div>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">PV DE LA RÉUNION</span>
                                        <span class="col-8" *ngIf="!pvCreer && (!docsPv||docsPv.length==0)">
                                            <button mat-mini-fab title="Ajouter un pv" color="primary"
                                                aria-label="Example icon-button with a heart icon" class="mr-2"
                                                data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                data-target="#pvModal" (click)="createNewPv()">
                                                <mat-icon>create</mat-icon>
                                            </button>
                                            <button mat-mini-fab color="primary" title="Importer un pv"
                                                aria-label="Example icon-button with a heart icon"
                                                (click)="docPv.click()">
                                                <mat-icon>file_upload</mat-icon>
                                            </button>
                                        </span>
                                        <span class="col-8" *ngIf="!pvCreer && (docsPv && docsPv.length>0)">
                                            <span class="" *ngFor="let pv of docsPv;let i=index">
                                                <mat-icon [title]="pv[0]" style="font-size: 50px;color: #3f51b5;">
                                                    insert_drive_file</mat-icon>
                                                <mat-icon [title]="'Supprimer '+pv[0]" class="pointer"
                                                    style="color: #f80000;" (click)='deletePv(i)'>cancel</mat-icon>
                                                <button class="addFile ml-5" mat-mini-fab (click)="docPv.click()"
                                                    *ngIf="i==(docsPv.length-1)" title="Ajouter un nouveau document"
                                                    color="primary" aria-label="Example icon-button with a heart icon">
                                                    <mat-icon>add</mat-icon>
                                                </button>
                                            </span>
                                        </span>
                                        <input type="file" id="doc2" (change)="handleFileInputPv($event.target.files)"
                                            hidden #docPv multiple>
                                        <span class="col-8" *ngIf="pvCreer">
                                            <span class="">
                                                <mat-icon title="Procès-verbal" style="font-size: 50px;color: #3f51b5;"
                                                    data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                    data-target="#pvModal">assignment</mat-icon>
                                                <mat-icon title="Supprimer le pv" class="mr-3 pointer"
                                                    style="color: #f80000;" (click)='deletCreationPv()'>cancel
                                                </mat-icon>
                                                <button class="addFile mr-5" mat-mini-fab title="Pv" color="primary"
                                                    aria-label="Example icon-button with a heart icon"
                                                    data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                    data-target="#pvModal">
                                                    <mat-icon>create</mat-icon>
                                                </button>
                                            </span>
                                        </span>
                                    </p>
                                </form>
                                <!--Corps-->
                                <mat-action-row>
                                    <button type="submit" class="btn btn-outline-success btn-border-radius mr-2"
                                        [disabled]="editForm.invalid"
                                        (click)="onEditSave(editForm)">Enregistrer</button>
                                    <button type="button" class="btn btn-outline-danger btn-border-radius mr-0"
                                        (click)="showForm=false">Annuler</button>
                                </mat-action-row>
                            </mat-expansion-panel>
                            <!--Add and Update-->

                            <!--List-->
                            <mat-expansion-panel class="mb-4" *ngFor="let inventaire of inventaires;let i=index"
                                hideToggle [hidden]="showForm"
                                [expanded]="inventaire.id===idCurrentInv ||idCurrentInv==0 && i==0"
                                (opened)="idCurrentInv=inventaire.id">
                                <mat-expansion-panel-header class="pr-0" style="background-color: #d8d5d5;" #panelHL
                                    (click)="panelHL._toggle()">
                                    <mat-panel-title class="pl-0 col-11 pt-5 pb-4 mr-0" (click)="panelHL._toggle()">
                                        <p>
                                            Inventaire <span *ngIf="inventaire.dateInv"> au
                                                {{inventaire.dateInv|date:'dd/MM/yyyy'}} </span>
                                        </p>
                                    </mat-panel-title>
                                    <mat-panel-description class="mr-0">
                                        <div class="pt-5 pb-4" *ngIf="!securityServ.superviseurAdjoint">
                                            <mat-icon data-toggle="modal" class="mr-2 icone-loc"
                                                (click)="updateOne(inventaire)">edit</mat-icon>
                                            <mat-icon class="icone-loc">delete</mat-icon>
                                        </div>
                                    </mat-panel-description>
                                </mat-expansion-panel-header>
                                <!--Corps-->
                                <div class="mt-4">
                                    <p class="row mt-3">
                                        <span class="col-4 bolder">DATE D'INVENTAIRE</span>
                                        <span class="col-4">{{inventaire.dateInv|date:'dd/MM/yyyy'}} </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-3">
                                        <span class="col-4 bolder">PÉRIODE DE COMPTAGE</span>
                                        <span class="col-4">Du : {{inventaire.debut|date:'dd/MM/yyyy'}} </span>
                                        <span class="col-4">Au : {{inventaire.fin|date:'dd/MM/yyyy'}}</span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"
                                            [ngClass]="{'pt-3': inventaire.localites && inventaire.localites.length>0}">LOCALITÉS</span>
                                        <span class="col-8">
                                            <span
                                                *ngIf="!inventaire.localites ||inventaire.localites && inventaire.localites.length==0">Aucune
                                                localité n'a été ajoutée</span>
                                            <button *ngFor="let localite of firstSub(inventaire.localites)"
                                                (click)="detailsLoc(inventaire)" data-toggle="modal"
                                                data-target="#localiteModal" mat-mini-fab [title]="localite.nom"
                                                color="primary" aria-label="Example icon-button with a heart icon"
                                                class="mr-2 " (mouseover)="overLoc(localite)"
                                                (mouseout)="outHoverLZS()">
                                                <mat-icon>room</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"
                                            [ngClass]="{'pt-4': inventaire.instruction && inventaire.instruction.length>0}">INSTRUCTIONS
                                            D'INVENTAIRE</span>
                                        <span class="col-8"
                                            *ngIf="!inventaire.instruction||inventaire.instruction.length==0">Aucune
                                            instruction n'a été ajoutée</span>
                                        <span class="col-8"
                                            *ngIf="inventaire.instruction && inventaire.instruction.length>0 && inventaire.localInstructionPv[0]!='creation'">
                                            <span *ngFor="let instruction of inventaire.instruction">
                                                <mat-icon class="mr-4 pointer" [title]="instruction[0]"
                                                    style="font-size: 50px;color: #3f51b5;" (click)="openInv.click()">
                                                    insert_drive_file</mat-icon>
                                                <a [href]="docLink + instruction[1]" [download]="instruction[0]"
                                                    target="_blank" rel="noopener noreferrer" #openInv hidden>open</a>
                                            </span>
                                        </span>
                                        <span class="col-8"
                                            *ngIf="inventaire.instruction && inventaire.instruction.length>0 && inventaire.localInstructionPv[0]=='creation'">
                                            <span>
                                                <mat-icon class="mr-4 pointer" title="Instruction"
                                                    style="font-size: 50px;color: #3f51b5;"
                                                    (click)="generatePdf(inventaire.instruction,0)">assignment
                                                </mat-icon>
                                            </span>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"
                                            [ngClass]="{'pt-3': inventaire.decisionCC && inventaire.decisionCC.length>0}">DÉCISION
                                            DE CRÉATION DU COMITÉ</span>
                                        <span class="col-8"
                                            *ngIf="!inventaire.decisionCC||inventaire.decisionCC.length==0">Aucune
                                            décision n'a été ajoutée</span>
                                        <span class="col-8"
                                            *ngIf="inventaire.decisionCC && inventaire.decisionCC.length>0">
                                            <span *ngFor="let decision of inventaire.decisionCC;let i=index">
                                                <mat-icon class="mr-4 pointer" [title]="decision[0]"
                                                    style="font-size: 50px;color: #3f51b5;" (click)="openDC.click()">
                                                    insert_drive_file</mat-icon>
                                                <a [href]="docLink + decision[1]" [download]="decision[0]"
                                                    target="_blank" rel="noopener noreferrer" #openDC hidden>open</a>
                                            </span>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"
                                            [ngClass]="{'pt-5': inventaire.presiComite || inventaire.membresCom.length>0}">COMITE
                                            D'INVENTAIRE</span>
                                        <span class="col-8 row">
                                            <span *ngIf="!inventaire.presiComite && inventaire.membresCom.length==0"
                                                class="pl-3">Membres du comité non définis</span>

                                            <img hidden *ngIf="inventaire.presiComite"
                                                class="img-circle user-img-circle img-membre pointer ml-2"
                                                [src]="imgLink+inventaire.presiComite.image"
                                                [title]="'Président du comité : '+ inventaire.presiComite.nom">
                                            <span *ngIf="inventaire.presiComite" class="p-0 pt-1 ml-3 mb-2 block-user">
                                                <img alt="photo"
                                                    class="img-circle user-img-circle img-membre pointer ng-star-inserted"
                                                    [src]="imgLink+inventaire.presiComite.image"
                                                    [title]="'Président du comité : '+ inventaire.presiComite.nom">
                                                <small>{{longText(inventaire.presiComite.nom,18)}}</small>
                                                <small class="text-primary titre-membre">Président</small>
                                            </span>

                                            <img hidden *ngFor="let membre of inventaire.membresCom"
                                                class="img-circle user-img-circle img-membre pointer ml-2"
                                                [src]="imgLink+membre.image"
                                                [title]="'Membre du comité : '+ membre.nom">
                                            <span *ngFor="let membre of inventaire.membresCom"
                                                class="p-0 pt-1 ml-3 mb-2  block-user">
                                                <img class="img-circle user-img-circle img-membre pointer ng-star-inserted"
                                                    [src]="imgLink+membre.image"
                                                    [title]="'Membre du comité : '+ membre.nom">
                                                <small>{{longText(membre.nom,18)}}</small>
                                                <small class="text-primary titre-membre">Membre</small>
                                            </span>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder">RÉUNION DE LANCEMENT</span>
                                        <span class="col-4">Lieu : {{inventaire.lieuReunion}}</span>
                                        <span class="col-4">Date : {{inventaire.dateReunion|date:'dd/MM/yyyy'}}</span>
                                    </p>
                                    <hr>
                                    <div class="row mt-4">
                                        <span class="col-4 bolder"
                                            [ngClass]="{'pt-5': inventaire.presentsReunionOut.length>0 || inventaire.presentsReunion.length>0,'pt-1':inventaire.presentsReunionOut.length==0 && inventaire.presentsReunion.length==0}">PRÉSENTS
                                            A LA RÉUNION</span>
                                        <span class="col-8 row">
                                            <span *ngIf="inventaire.presentsReunionOut.length==0 && inventaire.presentsReunion.length==0" class="pl-3">Membres présents à la réunion de lancement non définis</span>
                                            
                                            <img hidden *ngFor="let membre of inventaire.presentsReunion" class="img-circle user-img-circle img-membre pointer ml-2 mb-2" [src]="imgLink+membre.image" [title]="membre.nom">
                                            <span *ngFor="let membre of inventaire.presentsReunion" class="p-0 pt-1 ml-3 mb-2 block-user">
                                                <img class="img-circle user-img-circle img-membre pointer ng-star-inserted" [src]="imgLink+membre.image"  [title]="membre.nom">
                                                <small>{{longText(membre.nom,18)}}</small>
                                                <small class="text-primary titre-membre"
                                                    [title]="membre.poste">{{longText(membre.poste,18)}}</small>
                                            </span>


                                            <img hidden *ngFor="let membre of inventaire.presentsReunionOut"
                                                class="img-circle user-img-circle img-membre pointer ml-2 mb-2"
                                                [src]="imgLink+'exemple.jpg'" [title]="membre">
                                            <span *ngFor="let membre of inventaire.presentsReunionOut"
                                                class="p-0 pt-1 ml-3 mb-2 block-user">
                                                <img class="img-circle user-img-circle img-membre pointer ng-star-inserted"
                                                    [src]="imgLink+'exemple.jpg'" [title]="membre">
                                                <small>{{longText(membre,18)}}</small>
                                                <small class="text-primary titre-membre">Autre participant</small>
                                            </span>
                                        </span>
                                    </div>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"
                                            [ngClass]="{'pt-4': inventaire.pvReunion && inventaire.pvReunion.length>0}">PV
                                            DE LA RÉUNION</span>
                                        <span class="col-8"
                                            *ngIf="!inventaire.pvReunion ||inventaire.pvReunion && inventaire.pvReunion.length==0">Aucun
                                            pv n'a été ajouté</span>
                                        <span class="col-8"
                                            *ngIf="inventaire.pvReunion && inventaire.pvReunion.length>0 && inventaire.localInstructionPv[1]!='creation'">
                                            <span *ngFor="let pvReunion of inventaire.pvReunion">
                                                <mat-icon [title]="pvReunion[0]" style="font-size: 50px;color: #3f51b5;"
                                                    class="mr-4 pointer" (click)="openPv.click()">insert_drive_file
                                                </mat-icon>
                                                <a [href]="docLink + pvReunion[1]" download="pvReunion[0]"
                                                    target="_blank" rel="noopener noreferrer" #openPv hidden>open</a>
                                            </span>
                                        </span>
                                        <span class="col-8"
                                            *ngIf="inventaire.pvReunion && inventaire.pvReunion.length>0 && inventaire.localInstructionPv[1]=='creation'">
                                            <span>
                                                <mat-icon class="mr-4 pointer" color="primary" title="Procès-verbal"
                                                    style="font-size: 50px;color: #3f51b5;"
                                                    (click)="generatePdf(inventaire.pvReunion,1)">assignment</mat-icon>
                                            </span>
                                        </span>
                                    </p>
                                </div>
                                <!--Corps-->
                            </mat-expansion-panel>
                            <!--List-->
                        </mat-accordion>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal Window Add comité-->
<div class="modal fade" id="comiteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form class="modal-content">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17">Comité</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closeComiteModal class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body" [perfectScrollbar]>
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                        <mat-form-field class="example-full-width" appearance="outline">
                            <mat-label>Président</mat-label>
                            <mat-select [(ngModel)]="idPresiComite" name="presi">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let president of presidents" [value]="president.id">
                                    {{president.nom}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row mb-2" *ngFor="let control of tabComite.controls; index as i">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <mat-form-field class="example-full-width mr-2" appearance="outline"
                            style="width: 92% !important;">
                            <mat-label>Membre {{i+1}}</mat-label>
                            <mat-select [formControl]="control">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let membre of membresComite" [value]="membre.id"
                                    [hidden]="inTab(membre.id,tabComite.value)">{{membre.nom}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-icon matSuffix [hidden]="i!=(tabComite.controls.length-1) || !control.value"
                            (click)="addComMembre()" class="pointer" title="Ajouter un membre">add_circle_outline
                        </mat-icon>
                    </div>
                </div>
                <div class="modal-footer pr-2">
                    <div class="button-demo">
                        <button type="submit" class="btn btn-outline-success btn-border-radius"
                            (click)="closeComite()">Fermer</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Modal Window Add comité-->

<!-- Présents à la réunion-->
<div class="modal fade" id="presentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form class="modal-content">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17">Présents à la réunion</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closePresentModal class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body" [perfectScrollbar]>
                <div class="row mb-2" *ngFor="let control of tabPresents.controls; index as i">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <mat-form-field class="example-full-width mr-2" appearance="outline"
                            style="width: 92% !important;">
                            <mat-label>Participant {{i+1}}</mat-label>
                            <mat-select [formControl]="control">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let membre of users" [value]="membre.id"
                                    [hidden]="inTab(membre.id,tabPresents.value)">{{membre.nom}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-icon matSuffix [hidden]="i!=(tabPresents.controls.length-1) || !control.value"
                            (click)="addPresentMembre()" class="pointer" title="Ajouter un membre">add_circle_outline
                        </mat-icon>
                    </div>
                </div>
                <div class="row mb-2" *ngFor="let control of tabOtherPresent.controls; index as i">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <mat-form-field class="example-full-width mr-2" appearance="outline"
                            style="width: 92% !important;">
                            <mat-label>Autre participant</mat-label>
                            <input matInput [formControl]="control">
                            <mat-icon matSuffix>face</mat-icon>
                        </mat-form-field>
                        <mat-icon matSuffix [hidden]="i!=(tabOtherPresent.controls.length-1) || !control.value"
                            (click)="addOtherPres()" class="pointer" title="Ajouter un membre">add_circle_outline
                        </mat-icon>
                    </div>
                </div>
                <div class="modal-footer pr-2">
                    <div class="button-demo">
                        <button type="submit" class="btn btn-outline-success btn-border-radius"
                            (click)="closePresent()">Fermer</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Modal Window Add comité -->

 <!-- Localité -->
 <div class="modal fade" id="localiteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form class="modal-content">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17">Localités</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closeLocaliteModal
                    class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body pl-2 pr-2"  [perfectScrollbar]>
                <!-- Localités -->
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                    <!--1ere subdivision-->
                    <div class="p-2 mt-1 pb-4 box-loc">
                        <p class="ml-2">{{subdivisions[0]}}</p>
                        <hr>
                        <mat-chip-list aria-label="Fish selection" class="mt-4">
                            <mat-chip class="w-100 color-chips" [ngClass]="{'mt-3': i!=0}" *ngFor="let localite of firstSub(localites); index as i">
                                <span class="col-11 pl-0">
                                    <section class="example-section pick-loc">
                                        <mat-checkbox [disabled]="!showForm" class="example-margin pt-2" (change)="checkLoc(localite)" [checked]="isChecked(localite.id)">{{localite.nom}}</mat-checkbox>
                                    </section>
                                </span>
                                <span class="col-1">
                                    <mat-icon class="icone-affectation pointer text-info" title="Afficher" (click)="openFirst(localite.id)">remove_red_eye</mat-icon>
                                </span>
                            </mat-chip>
                        </mat-chip-list>
                    </div>
                    <!--1ere subdivision-->

                    <!--Autres subdivisions-->
                    <div *ngFor="let idParent of tabOpen;let i=index" class="p-2 mt-4 pb-4 box-loc" [hidden]="!openLocalite || !getOneLocById(idParent)">
                        <p class="mt-3 ml-2">{{getOneLocById(idParent)?.nom}}</p>
                        <hr>
                        <mat-chip-list aria-label="Fish selection">
                            <small class="ml-3" style="font-style: italic;">{{subdivisions[i+1]}}</small>
                            <mat-chip class="w-100 color-chips" [ngClass]="{'mt-3': i!=0}" *ngFor="let sub of getCurrentSubById(idParent);">
                                <span class="col-11 pl-0">
                                    <section class="example-section pick-loc">
                                        <mat-checkbox [disabled]="!showForm" class="example-margin pt-2" (change)="checkLoc(sub)" [checked]="isChecked(sub.id)">{{sub.nom}}</mat-checkbox>
                                    </section>
                                </span>
                                <span class="col-1">
                                    <mat-icon class="icone-affectation pointer text-info" title="Afficher" (click)="openOther(i+1,sub.id)">remove_red_eye</mat-icon>
                                </span>
                            </mat-chip>
                        </mat-chip-list>
                        <p *ngIf="getCurrentSubById(idParent).length==0" class="ml-2 mt-2">Cette subdivision est vide</p>
                    </div>
                    <!--Autres subdivisions-->
                </div>
                <!-- Localités -->
                <div class="row pl-4 pr-0 mt-4" *ngIf="showForm">
                    <div class="col-4">
                        <section class="example-section all-height row">
                            <mat-checkbox class="example-margin" (change)="checkAllLoc()" [checked]="allLocIsChec()">Toutes les localités</mat-checkbox>
                        </section>
                    </div>
                    <div class="col-5"></div>
                    <button type="submit" class="col-2 btn btn-outline-success btn-border-radius" (click)="closeLoc()">Fermer</button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Localité -->


<!-- Instruction -->
<div class="modal fade instructionModal inv" id="instrucModal" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog instruction-modal" role="document">
        <form class="modal-content" [formGroup]="instForm">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17">Instructions</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closeInstrucModal class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body" [perfectScrollbar]>
                <div class="row mb-2">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <div class="body pb-0">
                            <mat-vertical-stepper [linear]="isLinear" #stepper>
                                <mat-step>
                                    <ng-template matStepLabel>TRAVAUX PREPARATOIRES</ng-template>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" color="primary"
                                            appearance="outline">
                                            <mat-label>REUNION DE LANCEMENT DE L'INVENTAIRE</mat-label>
                                            <textarea matInput rows="3" formControlName="bloc1e1"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[0][0]">info_outline</mat-icon>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>RAPPEL DE LA PROCEDURES SUR LES IMMOBILISATIONS</mat-label>
                                            <textarea matInput rows="8" formControlName="bloc1e2"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[0][1]">info_outline</mat-icon>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="example-full-width  pr-0" appearance="outline">
                                            <mat-label>EDITION ET CONTRÔLE DU FICHIER DES IMMOBILISATIONS</mat-label>
                                            <textarea matInput rows="5" formControlName="bloc1e3"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[0][2]">info_outline</mat-icon>
                                    </div>
                                </mat-step>

                                <mat-step>
                                    <ng-template matStepLabel>TRAVAUX D'INVENTAIRE</ng-template>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>MISE EN PLACE DU COMITE D'INVENTAIRE</mat-label>
                                            <textarea matInput rows="10" formControlName="bloc2e1"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[1][0]">info_outline</mat-icon>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>AFFECTATION DES EQUIPES D'INVENTAIRE</mat-label>
                                            <textarea matInput rows="16" formControlName="bloc2e2"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[1][1]">info_outline</mat-icon>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>DEROULEMENT DE L'INVENTAIRE</mat-label>
                                            <textarea matInput rows="15" formControlName="bloc2e3"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[1][2]">info_outline</mat-icon>
                                    </div>
                                </mat-step>

                                <mat-step>
                                    <ng-template matStepLabel>TRAVAUX POST-INVENTAIRE</ng-template>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>RAPPROCHEMENT FICHIER D'IMMOBILISATIONS ET RESULTATS DE
                                                L'INVENTAIRE</mat-label>
                                            <textarea matInput rows="11" formControlName="bloc3e1"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[2][0]">info_outline</mat-icon>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>CORRECTION DES ANOMALIES</mat-label>
                                            <textarea matInput rows="1" formControlName="bloc3e2"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[2][1]">info_outline</mat-icon>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>APPROBATION D'INVENTAIRE</mat-label>
                                            <textarea matInput rows="1" formControlName="bloc3e3"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[2][2]">info_outline</mat-icon>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                                            <mat-label>TRANSMISSION DU DOSSIER D'INVENTAIRE</mat-label>
                                            <textarea matInput rows="3" formControlName="bloc3e4"></textarea>
                                        </mat-form-field>
                                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                            [title]="comments[2][3]">info_outline</mat-icon>
                                    </div>
                                </mat-step>

                                <mat-step hidden>
                                    <ng-template matStepLabel>SIGNATAIRES</ng-template>
                                    <div class="row col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                                        <mat-form-field class="example-chip-list example-full-width">
                                            <mat-chip-list #chipList1 aria-label="Fruit selection">
                                                <mat-chip *ngFor="let signataire of signatairesInst" [selectable]="true"
                                                    [removable]="true" (removed)="removeSignInst(signataire)">
                                                    {{signataire}}
                                                    <!-- <mat-icon class="ml-2 edit-sousZ pointer text-secondary" mat-raised-button (click)="openDialog()">create</mat-icon>  -->
                                                    <mat-icon matChipRemove>cancel</mat-icon>
                                                </mat-chip>
                                                <input placeholder="Signataires" [formControl]="signInstCtrl"
                                                    [matChipInputFor]="chipList1"
                                                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                                    (matChipInputTokenEnd)="addSignInst($event)">
                                            </mat-chip-list>
                                        </mat-form-field>
                                    </div>
                                </mat-step>
                            </mat-vertical-stepper>
                        </div>
                    </div>
                </div>
                <div class="modal-footer pr-2">
                    <div class="button-demo">
                        <button type="submit" class="btn btn-outline-success btn-border-radius"
                            (click)="closeInstrucModal.click()">Fermer</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Instruction -->

<!-- PV -->
<div class="modal fade inv" id="pvModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog instruction-modal" role="document">
        <form class="modal-content" [formGroup]="pvForm">
            <div class="modal-header">
                <div class="editRowModal">
                    <div class="modal-header clearfix">
                        <div class="modal-about">
                            <div class="font-weight-bold p-t-10 font-17">Procès-verbal</div>
                        </div>
                    </div>
                </div>
                <button type="button" #closePvModal class="btn p-t-10 modal-close-button" data-dismiss="modal"
                    aria-label="Close">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <div class="modal-body pr-1" [perfectScrollbar]>
                <div class="row mb-2">
                    <div class="row col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                            <mat-label>Date et heure </mat-label>
                            <textarea matInput rows="2" formControlName="bloc1"></textarea>
                        </mat-form-field>
                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary" [title]="commentsPv[0]">info_outline
                        </mat-icon>
                    </div>
                    <div class="row col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                            <mat-label>Ordre du jour </mat-label>
                            <textarea matInput rows="4" formControlName="bloc2"></textarea>
                        </mat-form-field>
                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary" [title]="commentsPv[1]">info_outline
                        </mat-icon>
                    </div>
                    <div class="row col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <mat-form-field class="example-full-width pr-0" appearance="outline">
                            <mat-label>Feuille de présence </mat-label>
                            <textarea matInput rows="3" formControlName="bloc3"></textarea>
                        </mat-form-field>
                        <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary" [title]="commentsPv[2]">info_outline
                        </mat-icon>
                    </div>
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0 pl-0"
                        *ngFor="let oneForm of tabDeliberation.controls; index as i">
                        <div class="row col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                            <mat-form-field class="example-full-width pr-0" appearance="outline">
                                <mat-label>Titre</mat-label>
                                <input matInput [formControl]="oneForm.controls.titre">
                            </mat-form-field>
                            <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary"
                                [hidden]="i!=(tabDeliberation.length-1)" (click)="addDeliberation()">add_circle_outline
                            </mat-icon>
                        </div>
                        <div class="row col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                            <mat-form-field class="example-full-width pr-0" appearance="outline">
                                <mat-label>DÉLIBERATION {{i+1}}</mat-label>
                                <textarea matInput rows="3" [formControl]="oneForm.controls.content"></textarea>
                            </mat-form-field>
                            <mat-icon matSuffix class="pointer pl-2 pt-3 text-primary" [title]="getCommentDel(i)">
                                info_outline</mat-icon>
                        </div>
                    </div>
                    <div class="row col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                        <mat-form-field class="example-chip-list example-full-width">
                            <mat-chip-list #chipList aria-label="Fruit selection">
                                <mat-chip *ngFor="let signataire of signatairesPv" [selectable]="true"
                                    [removable]="true" (removed)="removeSignPv(signataire)">
                                    {{signataire}}<mat-icon matChipRemove>cancel</mat-icon>
                                </mat-chip>
                                <input placeholder="Signataires" [formControl]="signPvCtrl" [matChipInputFor]="chipList"
                                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                    (matChipInputTokenEnd)="addSignPv($event)">
                            </mat-chip-list>
                        </mat-form-field>
                    </div>
                </div>
                <div class="modal-footer pr-2">
                    <div class="button-demo">
                        <button type="submit" class="btn btn-outline-success btn-border-radius"
                            (click)="closePvModal.click()">Fermer</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- PV -->