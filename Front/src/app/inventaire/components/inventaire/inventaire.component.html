<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card">
                    <div class="header">
                        <div class="row">
                            <h2 class="col-xl-3 col-lg-3 col-md-3 col-sm-3 pb-0 pt-2 bolder">Inventaires</h2>
                            <h2 class="col-xl-1 col-lg-2 col-md-2 col-sm-2 pb-0 pt-2 pr-0" [hidden]="entreprises && entreprises.length<=1">Entités :</h2>
                            <div class="col-xl-3 col-lg-3 col-md-5 col-sm-5 pb-0" [hidden]="entreprises && entreprises.length<=1">
                                <select [(ngModel)]="idCurrentEse" class="form-control select-trie" (change)="entiteChange($event.target.value)">
                                    <option *ngFor="let e of entreprises" [value]="e.id">{{e.denomination}}</option>
                                </select>
                            </div>
                            <ul class="header-dropdown m-r--5">
                                <li class="dropdown">
                                    <button class="addInv" (click)="addNew()" mat-mini-fab title="Ajouter un inventaire" color="primary" aria-label="Example icon-button with a heart icon">
                                        <mat-icon>add</mat-icon>
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="body">
                        <mat-accordion>
                            <!--Add and Update-->
                            <mat-expansion-panel class="mb-4" expanded="true" hideToggle *ngIf="showForm">
                                <mat-expansion-panel-header class="pr-0" style="background-color: #d8d5d5;">
                                    <mat-panel-title  class="pl-0 col-11 pt-5 pb-4 mr-0">
                                        <p>
                                           <span *ngIf="editForm.get('id').value==0">Ajouter </span> 
                                           <span *ngIf="editForm.get('id').value!=0">Modifier </span> 
                                           inventaire
                                        </p>
                                    </mat-panel-title>
                                    <mat-panel-description>
                            
                                    </mat-panel-description>
                                </mat-expansion-panel-header>
                                <!--Corps-->
                                <form class="mt-5" [formGroup]="editForm" #formDirective="ngForm">
                                    <div class="input-field col s12 d-none">
                                        <input formControlName="id" class="form-control" type="hidden">
                                    </div>
                                    <p class="row">
                                        <span class="col-4 bolder pt-3">PÉRIODE </span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Début</mat-label>
                                                <input matInput [matDatepicker]="picker" formControlName="debut">
                                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                                <mat-datepicker #picker></mat-datepicker>
                                            </mat-form-field>
                                        </span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Fin</mat-label>
                                                <input matInput [matDatepicker]="picker2" formControlName="fin">
                                                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                                <mat-datepicker #picker2></mat-datepicker>
                                                <mat-error *ngIf="editForm.get('fin').hasError('diffDate')">Inférieure à la date de début</mat-error>
                                            </mat-form-field>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">Localités</span>
                                        <span class="col-8">
                                            <button *ngFor="let idLoc of noNull(tabLoc)" mat-mini-fab [title]="getLocById(idLoc)?.nom" color="primary" aria-label="Example icon-button with a heart icon" class="mr-2"
                                            data-toggle="modal" data-backdrop="static" data-keyboard="false" data-target="#localiteModal">
                                                <mat-icon>room</mat-icon>
                                            </button>
                                            <button mat-mini-fab title="Ajouter une localité" color="primary" aria-label="Example icon-button with a heart icon" class="mr-2" data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                                data-target="#localiteModal">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">INSTRUCTIONS D'INVENTAIRE</span>
                                        <span class="col-8" *ngIf="!invCreer && (!instructions||instructions.length==0)"> 
                                            <button mat-mini-fab title="Ajouter des instructions" color="primary" aria-label="Example icon-button with a heart icon" class="mr-2" data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                            data-target="#instrucModal" (click)="invCreer=true">
                                                <mat-icon>create</mat-icon>
                                            </button>
                                            <button mat-mini-fab color="primary" title="Importer des instructions" aria-label="Example icon-button with a heart icon" (click)="docInst.click()">
                                                <mat-icon>file_upload</mat-icon>
                                            </button>
                                            <input type="file" id="doc" (change)="handleFileInput($event.target.files)" hidden #docInst multiple>
                                        </span>

                                        <span class="col-8" *ngIf="instructions && instructions.length>0 && !invCreer">
                                            <span class="" *ngFor="let instruction of instructions;let i=index">
                                               <mat-icon [title]="instruction[0]" style="font-size: 50px;color: #3f51b5;">insert_drive_file</mat-icon>
                                                <mat-icon [title]="'Supprimer '+instruction[0]" class="mr-3 pointer" style="color: #f80000;" (click)='deleteInst(i)'>cancel</mat-icon>
                                                <button class="addFile" mat-mini-fab (click)="docInst.click()" *ngIf="i==(instructions.length-1)" title="Ajouter un nouveau document" color="primary" aria-label="Example icon-button with a heart icon">
                                                    <mat-icon>add</mat-icon>
                                                </button>
                                            </span>
                                            <input type="file" id="doc" (change)="handleFileInput($event.target.files)" hidden #docInst multiple>
                                        </span>

                                        <span class="col-8" *ngIf="invCreer">
                                            <span class="">
                                               <mat-icon title="Instruction" style="font-size: 50px;color: #3f51b5;" data-keyboard="false"
                                               data-target="#instrucModal">insert_drive_file</mat-icon>
                                                <mat-icon title="Supprimer l'instruction" class="mr-3 pointer" style="color: #f80000;" (click)='invCreer=false'>cancel</mat-icon>
                                                <button class="addFile" mat-mini-fab title="Instruction" color="primary" aria-label="Example icon-button with a heart icon"
                                                data-toggle="modal" data-backdrop="static" data-keyboard="false" data-target="#instrucModal">
                                                    <mat-icon>create</mat-icon>
                                                </button>
                                            </span>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">DÉCISION CRÉATION COMITÉ</span>
                                        <span class="col-8" *ngIf="!docsDc||docsDc.length==0"> 
                                            <button mat-mini-fab color="primary"  (click)="docDec.click()" title="Importer la décision de création" aria-label="Example icon-button with a heart icon">
                                                <mat-icon>file_upload</mat-icon>
                                            </button>
                                        </span>
                                        <span class="col-8" *ngIf="docsDc && docsDc.length>0">
                                            <span class="" *ngFor="let decision of docsDc;let i=index">
                                               <mat-icon [title]="decision[0]" style="font-size: 50px;color: #3f51b5;">insert_drive_file</mat-icon>
                                                <mat-icon [title]="'Supprimer '+decision[0]" class="mr-3 pointer" style="color: #f80000;" (click)='deleteDc(i)'>cancel</mat-icon>
                                                <button class="addFile" mat-mini-fab (click)="docDec.click()" *ngIf="i==(docsDc.length-1)" title="Ajouter un nouveau document" color="primary" aria-label="Example icon-button with a heart icon">
                                                    <mat-icon>add</mat-icon>
                                                </button>
                                            </span>
                                            
                                        </span>
                                        <input type="file" id="docCrea" (change)="handleFileInputDc($event.target.files)" hidden #docDec multiple>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">COMITE D'INVENTAIRE</span>
                                        <span class="col-8">
                                            <img *ngIf="getUserById(idPresiComite)" class="img-circle user-img-circle img-membre pointer mr-2" [src]="imgLink+getUserById(idPresiComite).image" [title]="'Président du comité : '+ getUserById(idPresiComite).nom">
                                            <img *ngFor="let id of noNull(tabComite.value)" class="img-circle user-img-circle img-membre pointer mr-2" [src]="imgLink+getUserById(id)?.image" [title]="'Membre du comité : '+ getUserById(id)?.nom">
                                            <button mat-mini-fab color="primary" aria-label="Example icon-button with a heart icon" data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                            data-target="#comiteModal" (click)="openComModal()" [disabled]="users.length==0">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">RÉUNION D'INVENTAIRE</span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Lieu</mat-label>
                                                <input matInput formControlName="lieuReunion">
                                                <mat-icon matSuffix>room</mat-icon>
                                            </mat-form-field>
                                        </span>
                                        <span class="col-2">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Date</mat-label>
                                                <input matInput [matDatepicker]="picker3" formControlName="dateReunion">
                                                <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                                                <mat-datepicker #picker3></mat-datepicker>
                                            </mat-form-field>
                                        </span>
                                    </p>
                                    <hr>
                                    <div class="row mt-4">
                                        <span class="col-4 pt-3 bolder">PRÉSENTS A LA RÉUNION</span>
                                        <span class="col-8">
                                            <img *ngFor="let id of noNull(tabPresents.value)" class="img-circle user-img-circle img-membre pointer mr-2" [src]="imgLink+getUserById(id)?.image" [title]="getUserById(id)?.nom">
                                            <img *ngFor="let membre of noNull(tabOtherPresent.value)" class="img-circle user-img-circle img-membre pointer mr-2" [src]="imgLink+'exemple.jpg'" [title]="membre">
                                            <button mat-mini-fab color="primary" aria-label="Example icon-button with a heart icon" aria-label="Example icon-button with a heart icon" data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                            data-target="#presentModal" (click)="openPresModal()" [disabled]="users.length==0">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </span>
                                    </div>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">PV DE LA RÉUNION</span>
                                        <span class="col-8" *ngIf="!pvCreer && (!docsPv||docsPv.length==0)"> 
                                            <button mat-mini-fab title="Ajouter un pv" color="primary" aria-label="Example icon-button with a heart icon" class="mr-2" data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                            data-target="#pvModal">
                                                <mat-icon>create</mat-icon>
                                            </button>
                                            <button mat-mini-fab color="primary" title="Importer un pv" aria-label="Example icon-button with a heart icon" (click)="docPv.click()">
                                                <mat-icon>file_upload</mat-icon>
                                            </button>
                                        </span>
                                        <span class="col-8" *ngIf="!pvCreer && (docsPv && docsPv.length>0)">
                                            <span class="" *ngFor="let pv of docsPv;let i=index">
                                               <mat-icon [title]="pv[0]" style="font-size: 50px;color: #3f51b5;">insert_drive_file</mat-icon>
                                                <mat-icon [title]="'Supprimer '+pv[0]" class="mr-3 pointer" style="color: #f80000;" (click)='deletePv(i)'>cancel</mat-icon>
                                                <button class="addFile" mat-mini-fab (click)="docPv.click()" *ngIf="i==(docsPv.length-1)" title="Ajouter un nouveau document" color="primary" aria-label="Example icon-button with a heart icon">
                                                    <mat-icon>add</mat-icon>
                                                </button>
                                            </span>
                                        </span>
                                        <input type="file" id="doc2" (change)="handleFileInputPv($event.target.files)" hidden #docPv multiple>
                                        <span class="col-8" *ngIf="pvCreer">
                                            <span class="">
                                               <mat-icon title="Pv" style="font-size: 50px;color: #3f51b5;" data-toggle="modal" data-backdrop="static" data-keyboard="false"
                                               data-target="#pvModal">insert_drive_file</mat-icon>
                                                <mat-icon title="Supprimer le pv" class="mr-3 pointer" style="color: #f80000;" (click)='pvCreer=false'>cancel</mat-icon>
                                                <button class="addFile" mat-mini-fab title="Instruction" color="primary" aria-label="Example icon-button with a heart icon"
                                                data-toggle="modal" data-backdrop="static" data-keyboard="false" data-target="#instrucModal">
                                                    <mat-icon>create</mat-icon>
                                                </button>
                                            </span>
                                        </span>
                                    </p>
                                </form>
                                <!--Corps-->
                                <mat-action-row>
                                    <button type="submit" class="btn btn-outline-success btn-border-radius mr-2" [disabled]="editForm.invalid" (click)="onEditSave(editForm)">Enregistrer</button>
                                    <button type="button" class="btn btn-outline-danger btn-border-radius mr-0" (click)="showForm=false">Annuler</button>
                                </mat-action-row>
                            </mat-expansion-panel>
                            <!--Add and Update-->

                            <!--List-->
                            <mat-expansion-panel class="mb-4" *ngFor="let inventaire of forOnLyEntity(inventaires);let i=index" hideToggle [hidden]="showForm"  [expanded]="inventaire.id===idCurrentInv ||idCurrentInv==0 && i==0" (opened)="idCurrentInv=inventaire.id">
                                <mat-expansion-panel-header class="pr-0" style="background-color: #d8d5d5;" #panelHL (click)="panelHL._toggle()">
                                    <mat-panel-title  class="pl-0 col-11 pt-5 pb-4 mr-0" (click)="panelHL._toggle()">
                                        <p>
                                            Inventaire <span *ngIf="inventaire.debut"> du {{inventaire.debut|date:'dd-MM-yyyy'}} </span> <span *ngIf="inventaire.debut && inventaire.fin"> au {{inventaire.fin|date:'dd-MM-yyyy'}}</span>
                                        </p>
                                    </mat-panel-title>
                                    <mat-panel-description class="mr-0">
                                        <div class="pt-5 pb-4">
                                            <mat-icon data-toggle="modal" class="mr-2 icone-loc" (click)="updateOne(inventaire)">edit</mat-icon>
                                            <mat-icon class="icone-loc">delete</mat-icon>
                                        </div>
                                    </mat-panel-description>
                                </mat-expansion-panel-header>
                                <!--Corps-->
                                <div class="mt-5">
                                    <p class="row mt-3">
                                        <span class="col-4 bolder">PÉRIODE </span>
                                        <span class="col-4">Du : {{inventaire.debut|date:'dd-MM-yyyy'}} </span>
                                        <span class="col-4">Au : {{inventaire.fin|date:'dd-MM-yyyy'}}</span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"  [ngClass]="{'pt-3': inventaire.localites && inventaire.localites.length>0}">Localités</span>
                                        <span class="col-8">
                                            <span *ngIf="!inventaire.localites ||inventaire.localites && inventaire.localites.length==0">Aucune localité n'a été ajoutée</span>
                                            <button *ngFor="let localite of inventaire.localites" mat-mini-fab [title]="localite.nom" color="primary" aria-label="Example icon-button with a heart icon" class="mr-2">
                                                <mat-icon>room</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"  [ngClass]="{'pt-3': inventaire.zones?.length>0}">Zones</span>
                                        <span class="col-8">
                                            <span *ngIf="!inventaire.zones ||inventaire.zones?.length==0">Aucune zone n'a été ajoutée</span>
                                            <button *ngFor="let zone of inventaire.zones" mat-mini-fab [title]="zone.nom + ' ( '+zone.locName+' ) '" color="primary" aria-label="Example icon-button with a heart icon" class="mr-2">
                                                <mat-icon>room</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"  [ngClass]="{'pt-3': inventaire.sousZones?.length>0}">Sous zones</span>
                                        <span class="col-8">
                                            <span *ngIf="!inventaire.sousZones ||inventaire.sousZones?.length==0">Aucune sous-zone n'a été ajoutée</span>
                                            <button *ngFor="let sousZone of inventaire.sousZones" mat-mini-fab [title]="sousZone.nom+ ' ( '+sousZone.zonename+' ) '" color="primary" aria-label="Example icon-button with a heart icon" class="mr-2">
                                                <mat-icon>room</mat-icon>
                                            </button>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder" [ngClass]="{'pt-4': inventaire.instruction && inventaire.instruction.length>0}">INSTRUCTIONS D'INVENTAIRE</span>
                                        <span class="col-8" *ngIf="!inventaire.instruction||inventaire.instruction.length==0">Aucune instruction n'a été ajoutée</span>
                                        <span class="col-8 text-success" *ngIf="inventaire.instruction && inventaire.instruction.length>0 && inventaire.localInstructionPv[0]!='creation'">
                                            <span *ngFor="let instruction of inventaire.instruction">
                                                <mat-icon class="text-success mr-4 pointer" [title]="instruction[0]"  style="font-size: 50px;" (click)="openInv.click()">insert_drive_file</mat-icon>
                                                <a [href]="docLink + instruction[1]" [download]="instruction[0]" target="_blank" rel="noopener noreferrer" #openInv hidden>open</a>
                                            </span>
                                        </span>
                                        <span class="col-8 text-success" *ngIf="inventaire.instruction && inventaire.instruction.length>0 && inventaire.localInstructionPv[0]=='creation'">
                                            <span>
                                                <mat-icon class="text-success mr-4 pointer" title="Instruction"  style="font-size: 50px;" (click)="openInv.click()">insert_drive_file</mat-icon>
                                                <a href="" target="_blank" rel="noopener noreferrer" #openInv hidden>open</a>
                                            </span>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder" [ngClass]="{'pt-3': inventaire.decisionCC && inventaire.decisionCC.length>0}">DÉCISION CRÉATION COMITÉ</span>
                                        <span class="col-8" *ngIf="!inventaire.decisionCC||inventaire.decisionCC.length==0">Aucune décision n'a été ajoutée</span>
                                        <span class="col-8" *ngIf="inventaire.decisionCC && inventaire.decisionCC.length>0">
                                            <span  *ngFor="let decision of inventaire.decisionCC;let i=index">
                                               <mat-icon class="text-success mr-4 pointer" text-success [title]="decision[0]" style="font-size: 50px;color: #3f51b5;" (click)="openDC.click()">insert_drive_file</mat-icon>
                                               <a [href]="docLink + decision[1]" [download]="decision[0]" target="_blank" rel="noopener noreferrer" #openDC hidden>open</a>
                                            </span>
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 pt-3 bolder">COMITE D'INVENTAIRE</span>
                                        <span class="col-8"> 
                                            <span  *ngIf="!inventaire.presiComite && inventaire.membresCom.length==0">Membres du comité non définis</span>
                                            <img *ngIf="inventaire.presiComite" class="img-circle user-img-circle img-membre pointer ml-2" [src]="imgLink+inventaire.presiComite.image" [title]="'Président du comité : '+ inventaire.presiComite.nom">
                                            <img *ngFor="let membre of inventaire.membresCom" class="img-circle user-img-circle img-membre pointer ml-2" [src]="imgLink+membre.image" [title]="'Membre du comité : '+ membre.nom">
                                        </span>
                                    </p>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder">RÉUNION D'INVENTAIRE</span>
                                        <span class="col-4">Lieu : {{inventaire.lieuReunion}}</span>
                                        <span class="col-4">Date : {{inventaire.dateReunion|date:'dd-MM-yyyy à HH:mm'}}</span>
                                    </p>
                                    <hr>
                                    <div class="row mt-4">
                                        <span class="col-4 pt-3 bolder">PRÉSENTS A LA RÉUNION</span>
                                        <span class="col-8">
                                            <span *ngIf="inventaire.presentsReunionOut.length==0 && inventaire.presentsReunion.length==0">Membres présents à la réunion d'inventaire non définis</span>
                                            <img *ngFor="let membre of inventaire.presentsReunion" class="img-circle user-img-circle img-membre pointer ml-2" [src]="imgLink+membre.image" [title]="membre.nom">
                                            <img *ngFor="let membre of inventaire.presentsReunionOut" class="img-circle user-img-circle img-membre pointer ml-2" [src]="imgLink+'exemple.jpg'" [title]="membre">
                                        </span>
                                    </div>
                                    <hr>
                                    <p class="row mt-4">
                                        <span class="col-4 bolder"  [ngClass]="{'pt-4': inventaire.pvReunion && inventaire.pvReunion.length>0}">PV DE LA RÉUNION</span>
                                        <span class="col-8" *ngIf="!inventaire.pvReunion ||inventaire.pvReunion && inventaire.pvReunion.length==0">Aucun pv n'a été ajouté</span>
                                        <span class="col-8 text-success" *ngIf="inventaire.pvReunion && inventaire.pvReunion.length>0">
                                            <span *ngFor="let pvReunion of inventaire.pvReunion">
                                                <mat-icon [title]="pvReunion[0]" style="font-size: 50px;" class="mr-4 pointer" (click)="openPv.click()">insert_drive_file</mat-icon>
                                            <a [href]="docLink + pvReunion[1]" download="pvReunion[0]" target="_blank" rel="noopener noreferrer" #openPv hidden>open</a>
                                            </span>
                                            
                                        </span>
                                    </p>
                                </div>
                                <!--Corps-->
                            </mat-expansion-panel>
                            <!--List-->
                        </mat-accordion>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

 <!-- Modal Window Add comité-->
 <div class="modal fade" id="comiteModal" tabindex="-1" role="dialog"
 aria-labelledby="exampleModalLabel" aria-hidden="true">
 <div class="modal-dialog" role="document">
     <form class="modal-content">
         <div class="modal-header">
             <div class="editRowModal">
                 <div class="modal-header clearfix">
                     <div class="modal-about">
                         <div class="font-weight-bold p-t-10 font-17">Comité</div>
                     </div>
                 </div>
             </div>
             <button type="button" #closeComiteModal
                 class="btn p-t-10 modal-close-button" data-dismiss="modal"
                 aria-label="Close">
                 <i class="material-icons">clear</i>
             </button>
         </div>
         <div class="modal-body"  [perfectScrollbar]>
             <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                    <mat-form-field class="example-full-width" appearance="outline">
                        <mat-label>Président comité</mat-label>
                        <mat-select [(ngModel)]="idPresiComite" name="presi">
                            <mat-option  value=""></mat-option>
                            <mat-option *ngFor="let president of presidents" [value]="president.id">{{president.nom}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div class="row mb-2" *ngFor="let control of tabComite.controls; index as i">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-form-field class="example-full-width mr-2" appearance="outline" style="width: 92% !important;">
                        <mat-label>Membre {{i+1}}</mat-label>
                        <mat-select [formControl]="control">
                            <mat-option value=""></mat-option>
                            <mat-option *ngFor="let membre of membresComite" [value]="membre.id" [hidden]="inTab(membre.id,tabComite.value)">{{membre.nom}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                     <mat-icon matSuffix [hidden]="i!=(tabComite.controls.length-1) || !control.value" (click)="addComMembre()" class="pointer" title="Ajouter un membre">add_circle_outline</mat-icon>
                </div>
            </div>
            <div class="modal-footer pr-2">
                <div class="button-demo">
                    <button type="submit" class="btn btn-outline-success btn-border-radius" (click)="closeComite()">Fermer</button>
                </div>
            </div>
         </div>
     </form>
 </div>
</div>
<!-- Modal Window Add comité-->

 <!-- Présents à la réunion-->
 <div class="modal fade" id="presentModal" tabindex="-1" role="dialog"
 aria-labelledby="exampleModalLabel" aria-hidden="true">
 <div class="modal-dialog" role="document">
     <form class="modal-content">
         <div class="modal-header">
             <div class="editRowModal">
                 <div class="modal-header clearfix">
                     <div class="modal-about">
                         <div class="font-weight-bold p-t-10 font-17">Présents à la réunion</div>
                     </div>
                 </div>
             </div>
             <button type="button" #closePresentModal
                 class="btn p-t-10 modal-close-button" data-dismiss="modal"
                 aria-label="Close">
                 <i class="material-icons">clear</i>
             </button>
         </div>
         <div class="modal-body"  [perfectScrollbar]>
            <div class="row mb-2" *ngFor="let control of tabPresents.controls; index as i">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-form-field class="example-full-width mr-2" appearance="outline" style="width: 92% !important;">
                        <mat-label>Membre {{i+1}}</mat-label>
                        <mat-select [formControl]="control">
                            <mat-option  value=""></mat-option>
                            <mat-option *ngFor="let membre of users" [value]="membre.id" [hidden]="inTab(membre.id,tabPresents.value)">{{membre.nom}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                     <mat-icon matSuffix [hidden]="i!=(tabPresents.controls.length-1) || !control.value" (click)="addPresentMembre()" class="pointer" title="Ajouter un membre">add_circle_outline</mat-icon>
                </div>
            </div>
            <div class="row mb-2" *ngFor="let control of tabOtherPresent.controls; index as i">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-form-field class="example-full-width mr-2" appearance="outline" style="width: 92% !important;">
                        <mat-label>Autre</mat-label>
                        <input matInput [formControl]="control">
                        <mat-icon matSuffix>face</mat-icon>
                    </mat-form-field>
                     <mat-icon matSuffix [hidden]="i!=(tabOtherPresent.controls.length-1) || !control.value" (click)="addOtherPres()" class="pointer" title="Ajouter un membre">add_circle_outline</mat-icon>
                </div>
            </div>
            <div class="modal-footer pr-2">
                <div class="button-demo">
                    <button type="submit" class="btn btn-outline-success btn-border-radius" (click)="closePresent()">Fermer</button>
                </div>
            </div>
         </div>
     </form>
 </div>
</div>
<!-- Modal Window Add comité-->

 <!-- Localité -->
 <div class="modal fade" id="localiteModal" tabindex="-1" role="dialog"
 aria-labelledby="exampleModalLabel" aria-hidden="true">
 <div class="modal-dialog" role="document">
     <form class="modal-content">
         <div class="modal-header">
             <div class="editRowModal">
                 <div class="modal-header clearfix">
                     <div class="modal-about">
                         <div class="font-weight-bold p-t-10 font-17">Localités</div>
                     </div>
                 </div>
             </div>
             <button type="button" #closeLocaliteModal
                 class="btn p-t-10 modal-close-button" data-dismiss="modal"
                 aria-label="Close">
                 <i class="material-icons">clear</i>
             </button>
         </div>
         <div class="modal-body pl-2 pr-2"  [perfectScrollbar]>
            <!-- Localités -->
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                <mat-accordion>
                    <div class="row" style="padding-left: 1.2rem !important;">
                        <mat-expansion-panel  class="example-full-width mb-4 col-11 pl-0 pr-0" *ngFor="let localite of tabLoc" hideToggle>
                            <mat-expansion-panel-header style="background-color: #d8d5d538;"  #panelHL (click)="panelHL._toggle()">
                                    <mat-panel-title class="pl-0 col-10 pt-4 pb-4" (click)="panelHL._toggle()">
                                        {{localite.nom}}
                                    </mat-panel-title>
                                    <mat-panel-description> 
                                        <mat-icon class="icone-loc pt-4 pb-4" (click)="deleteLoc(localite,i)">delete</mat-icon>
                                    </mat-panel-description>
                            </mat-expansion-panel-header>

                            <p class="mt-4 mb-3 bolder">Zones / Sites</p>
                            <div class="row" style="padding-left: 1.2rem !important;">
                                <mat-expansion-panel class="mb-4 col-11 pl-0 pr-0" *ngFor="let zone of rev(localite.zones)" hideToggle [hidden]="!inTab(zone.id,tabZonesPick)">
                                    <mat-expansion-panel-header style="background-color: #eab9b9;" #panelHZ (click)="panelHZ._toggle()">
                                            <mat-panel-title class="pl-0 col-10 pt-4 pb-4" (click)="panelHZ._toggle()">
                                                {{zone.nom}}
                                            </mat-panel-title>
                                            <mat-panel-description>
                                                <mat-icon class="icone-loc  m-r--5 pt-4 pb-4" (click)="deleteZone(zone)">delete</mat-icon>
                                            </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <!--Sous-zones-->
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 mb-0">
                                            <div class="card">
                                                <div class="body pl-0 pr-0">
                                                    <section class="example-section all-height row" *ngIf="zone.sousZones.length>0">
                                                        <mat-checkbox class="example-margin" *ngFor="let sousZone of rev(zone.sousZones,1)" (change)="checkASZ(sousZone.id)" [checked]="inTab(sousZone.id,tabSousZPick)" [title]="sousZone.nom">{{sousZone.nom}}</mat-checkbox>
                                                    </section>
                                                    <span *ngIf="zone.sousZones.length==0">Il n'y a pas de sous-zone dans cette zone</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--Sous-zones-->

                                </mat-expansion-panel>
                                <p class="mt-3 pl-2" *ngIf="addZone">
                                    <i class="material-icons pointer" title="Ajouter zone/site" data-keyboard="false" *ngIf="rev(localite.zones).length>0 && addZone"  (click)="addZone=false">add_circle</i>
                                    <span *ngIf="rev(localite.zones).length==0">Il n'y a pas de zone dans cette localité</span>
                                </p>
                            </div>
                            <!--Select pour ajouter des zones-->
                            <mat-form-field class="example-full-width" appearance="outline"  *ngIf="!addZone">
                                    <mat-label>Zones</mat-label>
                                    <mat-select (selectionChange)="pickNewZone($event.value)">
                                        <mat-option *ngFor="let z of localite.zones" [value]="z" [hidden]="inTab(z.id,tabZonesPick)">{{z.nom}}</mat-option>
                                    </mat-select>                                                               
                            </mat-form-field>
                            <!--Select pour ajouter des zones-->

                        </mat-expansion-panel>
                        <mat-icon matSuffix class="pointer col-1 pl-2 pt-3" *ngIf="addLoc && tabLoc.length>0" (click)="addLoc=false" title="Ajouter une localité">add_circle_outline</mat-icon>
                    </div>

                    <!--Select pour ajouter des localités-->
                    <mat-form-field class="example-full-width" appearance="outline"  *ngIf="!addLoc||tabLoc.length==0">
                            <mat-label>Localités</mat-label>
                            
                            <mat-select (selectionChange)="pickNewLoc($event.value)" #newLoc>
                                <mat-option *ngFor="let l of localites" [value]="l" [hidden]="inTab(l,tabLoc)">{{l.nom}}</mat-option>
                            </mat-select>                                                               
                    </mat-form-field>
                    <!--Select pour ajouter des localités-->

                </mat-accordion>
            </div>
            <!-- Localités -->
            <div class="modal-footer pr-4">
                <div class="button-demo">
                    <button type="submit" class="btn btn-outline-success btn-border-radius" (click)="closeLoc()">Fermer</button>
                </div>
            </div>
         </div>
     </form>
 </div>
</div>
<!-- Localité -->

 <!-- Instruction -->
 <div class="modal fade" id="instrucModal" tabindex="-1" role="dialog"
 aria-labelledby="exampleModalLabel" aria-hidden="true">
 <div class="modal-dialog instruction-modal" role="document">
     <form class="modal-content"  [formGroup]="instForm">
         <div class="modal-header">
             <div class="editRowModal">
                 <div class="modal-header clearfix">
                     <div class="modal-about">
                         <div class="font-weight-bold p-t-10 font-17">Instruction</div>
                     </div>
                 </div>
             </div>
             <button type="button" #closeInstrucModal
                 class="btn p-t-10 modal-close-button" data-dismiss="modal"
                 aria-label="Close">
                 <i class="material-icons">clear</i>
             </button>
         </div>
         <div class="modal-body"  [perfectScrollbar]>
            <div class="row mb-2">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-accordion>
                        <div class="row">
                            <mat-expansion-panel  class="example-full-width mb-4" [expanded]="true" hideToggle>
                                <mat-expansion-panel-header style="background-color: #d8d5d5a2;">
                                        <mat-panel-title class="pl-0 col-10 pt-4 pb-4">
                                            TRAVAUX PREPARATOIRES
                                        </mat-panel-title>
                                        <mat-panel-description> 
                                        </mat-panel-description>
                                </mat-expansion-panel-header>
                                <div class="row pt-4">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>REUNION DE LANCEMENT DE L'INVENTAIRE</mat-label>
                                        <textarea matInput rows="3" formControlName="bloc1e1"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[0][0]">info_outline</mat-icon>
                                </div>
                                <div class="row">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>RAPPEL DE LA PROCEDURES SUR LES IMMOBILISATIONS</mat-label>
                                        <textarea matInput rows="8"  formControlName="bloc1e2"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[0][1]">info_outline</mat-icon>
                                </div>
                                <div class="row">
                                    <mat-form-field class="example-full-width  pr-0" appearance="outline">
                                        <mat-label>EDITION ET CONTRÔLE DU FICHIER DES IMMOBILISATIONS</mat-label>
                                        <textarea matInput rows="5" formControlName="bloc1e3"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[0][2]">info_outline</mat-icon>
                                </div>
                            </mat-expansion-panel>
                            
                            <mat-expansion-panel  class="example-full-width mb-4" hideToggle>
                                <mat-expansion-panel-header style="background-color: #d8d5d5a2;">
                                        <mat-panel-title class="pl-0 col-10 pt-4 pb-4">
                                            TRAVAUX D'INVENTAIRE
                                        </mat-panel-title>
                                        <mat-panel-description> 
                                        </mat-panel-description>
                                </mat-expansion-panel-header>
                                <div class="row pt-4">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>MISE EN PLACE DU COMITE D'INVENTAIRE</mat-label>
                                        <textarea matInput rows="10" formControlName="bloc2e1"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[1][0]">info_outline</mat-icon>
                                </div>
                                <div class="row">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>AFFECTATION DES EQUIPES D'INVENTAIRE</mat-label>
                                        <textarea matInput rows="16" formControlName="bloc2e2"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[1][1]">info_outline</mat-icon>
                                </div>
                                <div class="row">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>DEROULEMENT DE L'INVENTAIRE</mat-label>
                                        <textarea matInput rows="15" formControlName="bloc2e3"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[1][2]">info_outline</mat-icon>
                                </div>
                            </mat-expansion-panel>

                            <mat-expansion-panel  class="example-full-width" hideToggle>
                                <mat-expansion-panel-header style="background-color: #d8d5d5a2;">
                                        <mat-panel-title class="pl-0 col-10 pt-4 pb-4">
                                            TRAVAUX POST-INVENTAIRE
                                        </mat-panel-title>
                                        <mat-panel-description> 
                                        </mat-panel-description>
                                </mat-expansion-panel-header>
                                <div class="row pt-4">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>RAPPROCHEMENT FICHIER D'IMMOBILISATIONS ET RESULTATS DE L'INVENTAIRE</mat-label>
                                        <textarea matInput rows="11" formControlName="bloc3e1"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[2][0]">info_outline</mat-icon>
                                </div>
                                <div class="row">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>CORRECTION DES ANOMALIES</mat-label>
                                        <textarea matInput rows="1" formControlName="bloc3e2"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[2][1]">info_outline</mat-icon>
                                </div>
                                <div class="row">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>APPROBATION D'INVENTAIRE</mat-label>
                                        <textarea matInput rows="1" formControlName="bloc3e2"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[2][2]">info_outline</mat-icon>
                                </div>
                                <div class="row">
                                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                                        <mat-label>TRANSMISSION DU DOSSIER D'INVENTAIRE</mat-label>
                                        <textarea matInput rows="1" formControlName="bloc3e3"></textarea>
                                    </mat-form-field>
                                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="comments[2][3]">info_outline</mat-icon>
                                </div>
                            </mat-expansion-panel>

                        </div>
                    </mat-accordion>
                </div>
            </div>
            <div class="modal-footer pr-2">
                <div class="button-demo">
                    <button type="submit" class="btn btn-outline-success btn-border-radius" (click)="closeInstrucModal.click()">Fermer</button>
                </div>
            </div>
         </div>
     </form>
 </div>
</div>
<!-- Instruction -->

<!-- PV -->
<div class="modal fade" id="pvModal" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog instruction-modal" role="document">
    <form class="modal-content"  [formGroup]="pvForm">
        <div class="modal-header">
            <div class="editRowModal">
                <div class="modal-header clearfix">
                    <div class="modal-about">
                        <div class="font-weight-bold p-t-10 font-17">Procès-verbal</div>
                    </div>
                </div>
            </div>
            <button type="button" #closePvModal
                class="btn p-t-10 modal-close-button" data-dismiss="modal"
                aria-label="Close">
                <i class="material-icons">clear</i>
            </button>
        </div>
        <div class="modal-body"  [perfectScrollbar]>
           <div class="row mb-2">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                        <mat-label>Date et heure </mat-label>
                        <textarea matInput rows="2" formControlName="bloc1"></textarea>
                    </mat-form-field>
                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="commentsPv[0]">info_outline</mat-icon>
                </div>
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                        <mat-label>Ordre du jour </mat-label>
                        <textarea matInput rows="4" formControlName="bloc2"></textarea>
                    </mat-form-field>
                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="commentsPv[1]">info_outline</mat-icon>
                </div>
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                        <mat-label>Feuille de présence </mat-label>
                        <textarea matInput rows="3" formControlName="bloc3e1"></textarea>
                    </mat-form-field>
                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="commentsPv[2]">info_outline</mat-icon>
                </div>
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2 pr-0">
                    <mat-form-field class="example-full-width pr-0" appearance="outline">
                        <mat-label>DELIBERATION 1: INSTRUCTIONS D'INVENTAIRE</mat-label>
                        <textarea matInput rows="1" formControlName="bloc3e2"></textarea>
                    </mat-form-field>
                    <mat-icon matSuffix class="pointer pl-2 pt-3" [title]="commentsPv[3]">info_outline</mat-icon>
                </div>
           </div>
           <div class="modal-footer pr-2">
               <div class="button-demo">
                   <button type="submit" class="btn btn-outline-success btn-border-radius" (click)="closePvModal.click()">Fermer</button>
               </div>
           </div>
        </div>
    </form>
</div>
</div>
<!-- PV -->
